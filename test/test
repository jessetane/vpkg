#
# test
#

# go to own dir
cd "$(dirname "$BASH_SOURCE")"

# vars
t=0

check() {
  if [ $? == 0 ]
  then
    echo "✔ passed test #$((t++)): $1"
  else
    echo "✘ failed test #$((t++)): $1" >&2
    exit 1
  fi
}

setup() {
  teardown
  
  # download vpkgfile
  vpkgfile="$(curl "file://$(pwd)/../vpkgfile")" 
  check "download vpkgfile"
  
  # bootstrap
  mkdir tmp
  echo "$vpkgfile" | bash -s bootstrap "$(pwd)"/tmp
  check "bootstrap"
  
  # source fresh config
  source tmp/.vpkg
  check "config"
  
  # check our binary linked properly
  v=$(vpkg --version)
  check "binary version: vpkg-$v"
}

teardown() {
  rm -rf tmp
}

nodejs() {
  
  # for development
  vpkg="../bin/vpkg"
  
  # basic install
  echo "file://$(pwd)/fixtures/nodejs-vpkgfile" | "$vpkg" install nodejs
  check "nodejs default install"
  
  
}

# test bootstrapping
setup

# nodejs requires only simple vpkgfile so 
# we'll use that package for our basic test
nodejs
